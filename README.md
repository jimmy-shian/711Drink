# 711 飲料紀杯管理平台

本平台為一套以 Google Apps Script（GAS）與 Google Sheets 打造的「飲料寄杯管理系統」，模擬 7-11 飲料兌換邏輯。具備完整的帳密登入、授權註冊、客戶資料追蹤、操作歷史記錄與臨時查詢連結等功能。

前端使用 HTML + Bootstrap，後端整合 Google Sheets 作為資料儲存與操作核心。

---

## 🔧 技術架構

- **前端**：HTML + Bootstrap
- **後端**：Google Apps Script (GAS)
- **資料儲存**：Google Sheets
- **用戶授權與安全性**：帳號密碼登入 + 驗證碼註冊 + 時效性連結限制

---

## ✅ 功能說明

### 1. 使用者登入與註冊

- 登入使用基本帳密驗證，資料儲存在 `Admins` 工作表中。
- 註冊需輸入正確的驗證碼，該驗證碼由「最高管理員」可在 `Config` 工作表中設定與修改。
- 非授權人無法註冊或登入系統。

### 2. 顧客資料與工作表設計

#### 工作表配置：

- `Admins`：儲存所有管理者帳號與密碼。
- `Config`：儲存註冊驗證碼（例如 A1 儲存格）。
- `Customers`：顧客資料對照表，格式如下：

| 欄位         | 說明                   |
|--------------|------------------------|
| A欄：`CustomerID` | 顧客代號（如手機號碼）     |
| B欄：`CustomerName` | 顧客姓名              |
| C欄：`SheetName` | 對應顧客的專屬 Sheet 名稱 |

#### 顧客專屬 Sheet 格式：

每位顧客擁有獨立的工作表，記錄該顧客所有寄杯資訊與歷史異動：

| 飲料名稱 | 剩餘杯數 | 操作時間 | 操作者（店員） | 動作（增加/減少） | 異動數量 |
|----------|-----------|-----------|----------------|------------------|----------|

- 每筆異動資料會向右擴展紀錄，包含操作者、時間、異動狀態。
- 支援多種飲品記錄管理。
- 可透過顏色標註每筆異動（例如紅色表示減少，綠色表示增加），方便直覺檢視。

### 3. 臨時連結分享（使用者查詢介面）

- 管理員可為顧客產生一組「具時效性的臨時連結」。
- 該連結僅允許顧客：
  - 檢視自己的寄杯紀錄與歷史異動。
  - 不可修改資料、登入系統或瀏覽其他用戶內容。
- 連結使用亂數參數 + 失效時間控制，強化安全性。

---

## 📁 專案結構

| 檔案名稱         | 說明                         |
|------------------|------------------------------|
| `code.gs`        | Google Apps Script 主邏輯     |
| `index.html`     | 管理員登入與操作介面         |
| `userView.html`  | 使用者（顧客）查詢介面       |

---

## 📊 Google Sheets 結構

請在 Google Sheet 中建立以下工作表：

### 1. `Config`
- `A1`: 驗證碼（註冊時需輸入此碼）

### 2. `Admins`
| Username | Password | DisplayName |
|----------|----------|-------------|

### 2.1 更新管理員資料 API
- action: `updateAdmin`
- data:
  | key | type | description |
  |-----|------|-------------|
  | username | string | 帳號 (必填) |
  | oldPassword | string | 舊密碼 (必填) |
  | newPassword | string | 新密碼 (可選) |
  | newName | string | 新顯示名稱 (可選) |
- 回傳: `{ success:boolean, msg:string }`

### 3. `Customers`
| CustomerID | CustomerName |
|------------|--------------|

> 內部會額外儲存 `SheetName` 欄位以對應各顧客工作表，但前端及 API 不會傳回此欄位，以保護內部結構。

### 4. 各顧客專屬 Sheet（自動建立）
| 飲料名稱 | 剩餘杯數 | 操作時間 | 操作者 | 動作 | 異動數量 |
|----------|-----------|-----------|--------|------|----------|

---

## 🚀 部署教學

1. 前往 [Google Apps Script](https://script.google.com/) 建立新專案。
2. 建立下列檔案並貼入內容：
   - `code.gs`
   - `index.html`
   - `userView.html`
3. 在 `code.gs` 中，將 `SPREADSHEET_ID` 設定為你 Google Sheet 的 ID。
4. 點選右上角【部署】 →【新增部署】。
5. 類型選擇：「網頁應用程式」。
6. 設定：
   - **應用程式名稱**：711 飲料紀杯平台
   - **執行應用程式的身份**：自己
   - **誰可以存取**：任何人（含匿名）
7. 授權後取得部署網址，管理員可使用該網址登入管理系統。

---

## 🎨 顧客查詢頁面 UI 建議

- 使用 Bootstrap 卡片顯示每筆飲料資料。
- 使用顏色標記異動類型：
  - **綠色**：增加杯數
  - **紅色**：減少杯數
- 顯示歷史異動紀錄區塊，可依時間排序。

---

## 🔐 安全性建議

- 驗證碼應定期更換，避免濫用。
- 臨時連結建議使用亂數 UUID + 到期時間作驗證。
- 管理員登入資訊請妥善保管，避免在公開網域部署。

---

## 📞 聯絡與授權

本系統為內部使用原型，請依實際需求修改與擴充。資料僅儲存在 Google Sheet 中，請定期備份與控管存取權限。
